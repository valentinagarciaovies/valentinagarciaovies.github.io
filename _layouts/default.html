<!DOCTYPE html>
<html lang="en">
  {% include head.html %}
  <body>
      {% include header.html %}
      <section id="about">
        {% include about.html %}
      </section>
      <section id="projects">
        {% include projects.html %}
      </section>
      <section id="personal">
        {% include personal.html %}
      </section>
        {{ content }}
      {% include footer.html %}
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const carousels = document.querySelectorAll('.carousel-container');
      
          carousels.forEach(carouselContainer => {
              const track = carouselContainer.querySelector('.carousel-track');
              const items = Array.from(track.children);
              const nextButton = carouselContainer.querySelector('.carousel-button.next');
              const prevButton = carouselContainer.querySelector('.carousel-button.prev');
              const dotsContainer = carouselContainer.querySelector('.carousel-dots');
      
              if (!track || items.length === 0) {
                  // console.warn('Carousel track or items not found for a carousel instance.');
                  return;
              }
              
              // If only one item, disable carousel functionality
              if (items.length <= 1) {
                  if(nextButton) nextButton.style.display = 'none';
                  if(prevButton) prevButton.style.display = 'none';
                  if(dotsContainer) dotsContainer.style.display = 'none';
                  return;
              }
      
              let itemWidth = items[0].getBoundingClientRect().width;
              const originalItemCount = items.length;
              let currentIndex = 1; // Start at the first "real" item after prepended clone
              let isTransitioning = false;
              let autoPlayInterval = null;
              const autoPlayDelay = 5000; // 5 seconds, set to null or 0 to disable
      
              // --- Infinite Scroll Setup: Clone first and last items ---
              const firstClone = items[0].cloneNode(true);
              firstClone.classList.add('clone');
              firstClone.setAttribute('aria-hidden', 'true');
      
              const lastClone = items[originalItemCount - 1].cloneNode(true);
              lastClone.classList.add('clone');
              lastClone.setAttribute('aria-hidden', 'true');
      
              track.appendChild(firstClone);
              track.insertBefore(lastClone, items[0]);
      
              const allItems = Array.from(track.children); // Update with clones
      
              // Initial position
              track.style.transform = `translateX(-${itemWidth * currentIndex}px)`;
      
              // --- Dots ---
              if (dotsContainer) {
                  for (let i = 0; i < originalItemCount; i++) {
                      const dot = document.createElement('button');
                      dot.classList.add('dot');
                      dot.setAttribute('aria-label', `Go to slide ${i + 1}`);
                      if (i === 0) dot.classList.add('active');
                      dot.addEventListener('click', () => {
                          if (isTransitioning) return;
                          currentIndex = i + 1; // +1 because of the prepended clone
                          moveToSlide();
                          resetAutoPlay();
                      });
                      dotsContainer.appendChild(dot);
                  }
              }
              const dots = dotsContainer ? Array.from(dotsContainer.children) : [];
      
              function updateDots() {
                  if (!dotsContainer || dots.length === 0) return;
                  dots.forEach(dot => dot.classList.remove('active'));
                  const activeDotIndex = (currentIndex - 1 + originalItemCount) % originalItemCount;
                  if (dots[activeDotIndex]) {
                      dots[activeDotIndex].classList.add('active');
                  }
              }
              
              function moveToSlide() {
                  isTransitioning = true;
                  track.style.transition = 'transform 0.5s ease-in-out';
                  track.style.transform = `translateX(-${itemWidth * currentIndex}px)`;
                  updateDots();
              }
      
              // --- Navigation ---
              function moveToNext() {
                  if (isTransitioning) return;
                  currentIndex++;
                  moveToSlide();
              }
      
              function moveToPrev() {
                  if (isTransitioning) return;
                  currentIndex--;
                  moveToSlide();
              }
      
              if (nextButton) nextButton.addEventListener('click', () => {
                  moveToNext();
                  resetAutoPlay();
              });
              if (prevButton) prevButton.addEventListener('click', () => {
                  moveToPrev();
                  resetAutoPlay();
              });
      
              // --- Handle Transition End for Infinite Loop ---
              track.addEventListener('transitionend', () => {
                  isTransitioning = false;
                  // Check if current slide is a clone
                  if (currentIndex === 0 || currentIndex === allItems.length - 1) {
                      track.style.transition = 'none'; // Disable transition for the jump
                      if (currentIndex === 0) { // Was at lastClone (prepended)
                          currentIndex = originalItemCount; // Jump to the real last item
                      } else { // Was at firstClone (appended) (currentIndex === allItems.length - 1)
                          currentIndex = 1; // Jump to the real first item
                      }
                      track.style.transform = `translateX(-${itemWidth * currentIndex}px)`;
                  }
              });
      
              // --- Autoplay ---
              function startAutoPlay() {
                  if (!autoPlayDelay || autoPlayDelay <=0) return;
                  stopAutoPlay(); // Clear existing interval
                  autoPlayInterval = setInterval(() => {
                      moveToNext();
                  }, autoPlayDelay);
              }
      
              function stopAutoPlay() {
                  clearInterval(autoPlayInterval);
              }
      
              function resetAutoPlay() {
                  stopAutoPlay();
                  startAutoPlay();
              }
              
              // Pause autoplay on hover
              carouselContainer.addEventListener('mouseenter', stopAutoPlay);
              carouselContainer.addEventListener('mouseleave', startAutoPlay);
              
              // Pause autoplay on focus within
              carouselContainer.addEventListener('focusin', stopAutoPlay);
              carouselContainer.addEventListener('focusout', startAutoPlay);
      
      
              // --- Responsiveness ---
              function handleResize() {
                  // Ensure itemWidth is based on the carousel container's current width
                  itemWidth = carouselContainer.getBoundingClientRect().width;
                  
                  track.style.transition = 'none'; // No animation on resize
                  track.style.transform = `translateX(-${itemWidth * currentIndex}px)`;
              }
      
              window.addEventListener('resize', handleResize);
      
              // Initial setup
              updateDots();
              startAutoPlay(); // Start autoplay if enabled
          });
      });
      
      </script>
  </body>
